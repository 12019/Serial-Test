# ---- CONFIGURATION ------
JAVA_HOME = C:/j2sdk1.4.0
ANTLR = C:/Dev/JavaDev/antlr/antlr-2.7.2a2
DLL = antlr.runtime.dll
EXE = generator.exe
ARCHIVE = glGenerator.tgz

# ------ PROJECT VARIABLES --------
TRASH = $(wildcard *.antlr.tmp) \
	GLTranslatorTokenTypes.txt GLExtTokenTypes.txt
GENERATED_1 = GLExtTokenTypes.cs GLLexer.cs GLParser.cs
GENERATED_2 = GLTranslator.cs GLTranslatorTokenTypes.cs
	
GRAMMAR = parser.g translator.g
SRC = GLGenerator.cs CodeHelper.cs CallHelper.cs GLType.cs GLArgs.cs

# --------- RULES ---------------
all: $(EXE)
$(EXE): $(SRC) $(GENERATED_1) $(GENERATED_2)
	csc /nologo /r:antlr.runtime.dll /nowarn:219,162,168 \
		/out:$@ $^
	
$(GENERATED_1): parser.g
	$(JAVA_HOME)/bin/java -cp $(ANTLR) antlr.Tool parser.g
	touch $(GENERATED_1)
	
$(GENERATED_2): translator.g $(GENERATED_1)
	$(JAVA_HOME)/bin/java -cp $(ANTLR) antlr.Tool translator.g
	touch $(GENERATED_2)

clean:
	-rm -f $(TRASH) $(GENERATED_1) $(GENERATED_2)
	
zip: $(ARCHIVE)
$(ARCHIVE): $(GRAMMAR) $(SRC) $(DLL) GNUmakefile ShowTree.java README.txt
	tar czf $@ $^
	
dist: all zip clean
	
test: all
	$(EXE) gl1.2.txt
	#csc /unsafe /r:csgl.dll /t:library /out:extension.dll extension.cs


# test/dev target
# show the AST generated by the parser
# you need to comment 'language="CSharp"' for this
showtree: override CLASSPATH=$(ANTLR);.
export CLASSPATH
showtree:
	$(JAVA_HOME)/bin/java  antlr.Tool parser.g
	$(JAVA_HOME)/bin/javac $(wildcard *.java)
	$(JAVA_HOME)/bin/java  ShowTree gl1.2.txt
